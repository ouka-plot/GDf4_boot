{
    "version": "2.0.0",
    "tasks": [
        // ==================== Boot æ„å»º ====================
        {
            "label": "Boot-CMake-Configure",
            "type": "shell",
            "command": "docker run --rm -v \"${workspaceFolder}:/app\" gd32-env cmake -S boot -B build_boot -GNinja",
            "group": "build",
            "problemMatcher": []
        },
        {
            "label": "Boot-Build",
            "type": "shell",
            "command": "docker run --rm -v \"${workspaceFolder}:/app\" gd32-env ninja -C build_boot",
            "group": "build",
            "problemMatcher": {
                "owner": "cpp",
                "fileLocation": ["autoDetect", "${workspaceFolder}"],
                "pattern": {
                    "regexp": "^/app/(.*):(\\d+):(\\d+):\\s+(warning|error):\\s+(.*)$",
                    "file": 1, "line": 2, "column": 3, "severity": 4, "message": 5
                }
            }
        },
        {
            "label": "Flash-Boot",
            "type": "shell",
            "command": ".\\flash_boot.bat",
            "group": "build",
            "dependsOn": ["Boot-Build"],
            "problemMatcher": []
        },
        // ==================== APP æ„å»º ====================
        {
            "label": "App-CMake-Configure",
            "type": "shell",
            "command": "docker run --rm -v \"${workspaceFolder}:/app\" gd32-env cmake -S app -B build_app -GNinja",
            "group": "build",
            "problemMatcher": []
        },
        {
            "label": "App-Build",
            "type": "shell",
            "command": "docker run --rm -v \"${workspaceFolder}:/app\" gd32-env ninja -C build_app",
            "group": "build",
            "problemMatcher": {
                "owner": "cpp",
                "fileLocation": ["autoDetect", "${workspaceFolder}"],
                "pattern": {
                    "regexp": "^/app/(.*):(\\d+):(\\d+):\\s+(warning|error):\\s+(.*)$",
                    "file": 1, "line": 2, "column": 3, "severity": 4, "message": 5
                }
            }
        },
        {
            "label": "Flash-App",
            "type": "shell",
            "command": ".\\flash_app.bat",
            "group": "build",
            "dependsOn": ["App-Build"],
            "problemMatcher": []
        },
        // ==================== ç»„åˆä»»åŠ¡ ====================
        {
            "label": "ğŸš€ Boot: æ„å»º+çƒ§å½•",
            "dependsOn": ["Flash-Boot"],
            "group": { "kind": "build", "isDefault": true },
            "problemMatcher": []
        },
        {
            "label": "ğŸš€ App: æ„å»º+çƒ§å½•",
            "dependsOn": ["Flash-App"],
            "group": "build",
            "problemMatcher": []
        },
        {
            "label": "ğŸ”„ Boot: å®Œæ•´é‡å»º+çƒ§å½•",
            "dependsOn": ["Boot-CMake-Configure", "Boot-Build", "Flash-Boot"],
            "dependsOrder": "sequence",
            "group": "build",
            "problemMatcher": []
        },
        {
            "label": "ğŸ”„ App: å®Œæ•´é‡å»º+çƒ§å½•",
            "dependsOn": ["App-CMake-Configure", "App-Build", "Flash-App"],
            "dependsOrder": "sequence",
            "group": "build",
            "problemMatcher": []
        },
        {
            "label": "Clean All",
            "type": "shell",
            "command": "Remove-Item -Recurse -Force build_boot/*, build_app/* -ErrorAction SilentlyContinue",
            "problemMatcher": []
        },
        // ==================== æœ¬åœ°è°ƒè¯•å·¥å…· ====================
        {
            "type": "cppbuild",
            "label": "C/C++: gcc.exe ç”Ÿæˆæ´»åŠ¨æ–‡ä»¶",
            "command": "D:\\software\\x86_64-15.1.0-release-win32-seh-msvcrt-rt_v12-rev0\\mingw64\\bin\\gcc.exe",
            "args": ["-fdiagnostics-color=always", "-g", "${file}", "-o", "${fileDirname}\\${fileBasenameNoExtension}.exe"],
            "options": { "cwd": "${fileDirname}" },
            "problemMatcher": ["$gcc"],
            "group": { "kind": "build", "isDefault": false },
            "detail": "è°ƒè¯•å™¨ç”Ÿæˆçš„ä»»åŠ¡ã€‚"
        },
        {
            "type": "cppbuild",
            "label": "C/C++: cl.exe ç”Ÿæˆæ´»åŠ¨æ–‡ä»¶",
            "command": "cl.exe",
            "args": ["/Zi", "/EHsc", "/nologo", "/Fe${fileDirname}\\${fileBasenameNoExtension}.exe", "${file}"],
            "options": { "cwd": "${fileDirname}" },
            "problemMatcher": ["$msCompile", "$gcc"],
            "group": { "kind": "build", "isDefault": false },
            "detail": "è°ƒè¯•å™¨ç”Ÿæˆçš„ä»»åŠ¡ã€‚"
        }
    ]
}